<ПравилаРегистрации>
	<ВерсияФормата>2.01</ВерсияФормата>
	<Ид>ad7d9d4b-c846-11e7-b5aa-78e3b506986f</Ид>
	<Наименование>ABSOLUT_CRM: Обмен данными {New CRM - УПН}</Наименование>
	<ДатаВремяСоздания>2018-07-04T13:34:00</ДатаВремяСоздания>
	<ПланОбмена Имя="ОбменУПНNewCRM">ПланОбменаСсылка.ОбменУПНNewCRM</ПланОбмена>
	<Конфигурация ВерсияПлатформы="8.2" ВерсияКонфигурации="1.0.0.3" СинонимКонфигурации="CRM ABSOLUT ">ABSOLUT_CRM</Конфигурация>
	<СоставПланаОбмена>
		<Элемент>
			<Тип>ДокументСсылка.СообщениеSMS</Тип>
			<Авторегистрация>false</Авторегистрация>
		</Элемент>
		<Элемент>
			<Тип>СправочникСсылка.УточнениеРасшифровкиИсточниковПриходаКлиента</Тип>
			<Авторегистрация>false</Авторегистрация>
		</Элемент>
		<Элемент>
			<Тип>СправочникСсылка.Клиенты</Тип>
			<Авторегистрация>false</Авторегистрация>
		</Элемент>
		<Элемент>
			<Тип>ДокументСсылка.ЗаявкаНаСделку</Тип>
			<Авторегистрация>false</Авторегистрация>
		</Элемент>
		<Элемент>
			<Тип>СправочникСсылка.РасшифровкаИсточниковПриходаКлиента</Тип>
			<Авторегистрация>false</Авторегистрация>
		</Элемент>
		<Элемент>
			<Тип>ДокументСсылка.ЗаявкаНаВыводОНВПродажу</Тип>
			<Авторегистрация>false</Авторегистрация>
		</Элемент>
		<Элемент>
			<Тип>РегистрСведенийЗапись.СоответствияОбъектовИнформационныхБаз</Тип>
			<Авторегистрация>false</Авторегистрация>
		</Элемент>
		<Элемент>
			<Тип>РегистрСведенийЗапись.СтатусыСделки</Тип>
			<Авторегистрация>false</Авторегистрация>
		</Элемент>
	</СоставПланаОбмена>
	<ПравилаРегистрацииОбъектов>
		<Группа Отключить="false">
			<Код>000000004</Код>
			<Наименование>Документы</Наименование>
			<Правило Отключить="false" Валидное="true">
				<Код>000000010</Код>
				<Наименование>Заявка на вывод ОН в продажу</Наименование>
				<ОбъектНастройки>ДокументСсылка.ЗаявкаНаВыводОНВПродажу</ОбъектНастройки>
				<ОбъектМетаданныхИмя>Документ.ЗаявкаНаВыводОНВПродажу</ОбъектМетаданныхИмя>
				<ОбъектМетаданныхТип>Документ</ОбъектМетаданныхТип>
				<ОтборПоСвойствамПланаОбмена>
					<ЭлементОтбора>
						<ЭтоСтрокаКонстанты>false</ЭтоСтрокаКонстанты>
						<ТипСвойстваОбъекта>СправочникСсылка.Проекты</ТипСвойстваОбъекта>
						<СвойствоПланаОбмена>[ПроектыДляОбменаСУПН].Проект</СвойствоПланаОбмена>
						<ВидСравнения>Равно</ВидСравнения>
						<СвойствоОбъекта>ОбъектНедвижимости.Владелец.Проект</СвойствоОбъекта>
						<ТаблицаСвойствОбъекта>
							<Свойство>
								<Наименование>ОбъектНедвижимости</Наименование>
								<Тип>СправочникСсылка.ОбъектыНедвижимости</Тип>
								<Вид>Реквизит</Вид>
							</Свойство>
							<Свойство>
								<Наименование>Владелец</Наименование>
								<Тип>СправочникСсылка.ОбъектыСтроительства</Тип>
								<Вид>Свойство</Вид>
							</Свойство>
							<Свойство>
								<Наименование>Проект</Наименование>
								<Тип>СправочникСсылка.Проекты</Тип>
								<Вид>Реквизит</Вид>
							</Свойство>
						</ТаблицаСвойствОбъекта>
						<ТаблицаСвойствПланаОбмена>
							<Свойство>
								<Наименование>[ПроектыДляОбменаСУПН]</Наименование>
								<Вид>ТабличнаяЧасть</Вид>
							</Свойство>
							<Свойство>
								<Наименование>Проект</Наименование>
								<Тип>СправочникСсылка.Проекты</Тип>
								<Вид>Реквизит</Вид>
							</Свойство>
						</ТаблицаСвойствПланаОбмена>
					</ЭлементОтбора>
				</ОтборПоСвойствамПланаОбмена>
				<ОтборПоСвойствамОбъекта>
					<ЭлементОтбора>
						<ТипСвойстваОбъекта>ПеречислениеСсылка.СтатусЗаявкиНаВыводОНВПродажу</ТипСвойстваОбъекта>
						<ВидСравнения>Равно</ВидСравнения>
						<СвойствоОбъекта>Статус</СвойствоОбъекта>
						<Вид>АлгоритмЗначения</Вид>
						<ЗначениеКонстанты>Значение = Перечисления.СтатусЗаявкиНаВыводОНВПродажу.СогласованаРуководителемФилиала;</ЗначениеКонстанты>
						<ТаблицаСвойствОбъекта>
							<Свойство>
								<Наименование>Статус</Наименование>
								<Тип>ПеречислениеСсылка.СтатусЗаявкиНаВыводОНВПродажу</Тип>
								<Вид>Реквизит</Вид>
							</Свойство>
						</ТаблицаСвойствОбъекта>
					</ЭлементОтбора>
				</ОтборПоСвойствамОбъекта>
			</Правило>
			<Правило Отключить="false" Валидное="true">
				<Код>000000003</Код>
				<Наименование>Заявка на сделку</Наименование>
				<ОбъектНастройки>ДокументСсылка.ЗаявкаНаСделку</ОбъектНастройки>
				<ОбъектМетаданныхИмя>Документ.ЗаявкаНаСделку</ОбъектМетаданныхИмя>
				<ОбъектМетаданныхТип>Документ</ОбъектМетаданныхТип>
				<ОтборПоСвойствамПланаОбмена>
					<ЭлементОтбора>
						<ЭтоСтрокаКонстанты>false</ЭтоСтрокаКонстанты>
						<ТипСвойстваОбъекта>СправочникСсылка.Проекты</ТипСвойстваОбъекта>
						<СвойствоПланаОбмена>[ПроектыДляОбменаСУПН].Проект</СвойствоПланаОбмена>
						<ВидСравнения>Равно</ВидСравнения>
						<СвойствоОбъекта>Проект</СвойствоОбъекта>
						<ТаблицаСвойствОбъекта>
							<Свойство>
								<Наименование>Проект</Наименование>
								<Тип>СправочникСсылка.Проекты</Тип>
								<Вид>Реквизит</Вид>
							</Свойство>
						</ТаблицаСвойствОбъекта>
						<ТаблицаСвойствПланаОбмена>
							<Свойство>
								<Наименование>[ПроектыДляОбменаСУПН]</Наименование>
								<Вид>ТабличнаяЧасть</Вид>
							</Свойство>
							<Свойство>
								<Наименование>Проект</Наименование>
								<Тип>СправочникСсылка.Проекты</Тип>
								<Вид>Реквизит</Вид>
							</Свойство>
						</ТаблицаСвойствПланаОбмена>
					</ЭлементОтбора>
				</ОтборПоСвойствамПланаОбмена>
				<ОтборПоСвойствамОбъекта/>
				<ПередОбработкой>Если НЕ Выгрузка Тогда
	Отказ = НЕ Объект.ДополнительныеСвойства.Свойство("РегистрацияВнешняя");
КонецЕсли;</ПередОбработкой>
			</Правило>
			<Правило Отключить="false" Валидное="true">
				<Код>000000009</Код>
				<Наименование>Сообщение SMS</Наименование>
				<ОбъектНастройки>ДокументСсылка.СообщениеSMS</ОбъектНастройки>
				<ОбъектМетаданныхИмя>Документ.СообщениеSMS</ОбъектМетаданныхИмя>
				<ОбъектМетаданныхТип>Документ</ОбъектМетаданныхТип>
				<ОтборПоСвойствамПланаОбмена>
					<ЭлементОтбора>
						<ЭтоСтрокаКонстанты>false</ЭтоСтрокаКонстанты>
						<ТипСвойстваОбъекта>СправочникСсылка.Пользователи</ТипСвойстваОбъекта>
						<СвойствоПланаОбмена>ОтветственныйДляСМС_УПН</СвойствоПланаОбмена>
						<ВидСравнения>Равно</ВидСравнения>
						<СвойствоОбъекта>Ответственный</СвойствоОбъекта>
						<ТаблицаСвойствОбъекта>
							<Свойство>
								<Наименование>Ответственный</Наименование>
								<Тип>СправочникСсылка.Пользователи</Тип>
								<Вид>Реквизит</Вид>
							</Свойство>
						</ТаблицаСвойствОбъекта>
						<ТаблицаСвойствПланаОбмена>
							<Свойство>
								<Наименование>ОтветственныйДляСМС_УПН</Наименование>
								<Тип>СправочникСсылка.Пользователи</Тип>
								<Вид>Реквизит</Вид>
							</Свойство>
						</ТаблицаСвойствПланаОбмена>
					</ЭлементОтбора>
				</ОтборПоСвойствамПланаОбмена>
				<ОтборПоСвойствамОбъекта/>
			</Правило>
		</Группа>
		<Группа Отключить="false">
			<Код>000000005</Код>
			<Наименование>Справочники</Наименование>
			<Правило Отключить="false" Валидное="true">
				<Код>000000006</Код>
				<Наименование>Клиенты</Наименование>
				<ОбъектНастройки>СправочникСсылка.Клиенты</ОбъектНастройки>
				<ОбъектМетаданныхИмя>Справочник.Клиенты</ОбъектМетаданныхИмя>
				<ОбъектМетаданныхТип>Справочник</ОбъектМетаданныхТип>
				<ОтборПоСвойствамПланаОбмена/>
				<ОтборПоСвойствамОбъекта>
					<ЭлементОтбора>
						<ТипСвойстваОбъекта>Строка</ТипСвойстваОбъекта>
						<ВидСравнения>НеРавно</ВидСравнения>
						<СвойствоОбъекта>GUID</СвойствоОбъекта>
						<Вид>ЗначениеКонстанты</Вид>
						<ЗначениеКонстанты>""</ЗначениеКонстанты>
						<ТаблицаСвойствОбъекта>
							<Свойство>
								<Наименование>GUID</Наименование>
								<Тип>Строка</Тип>
								<Вид>Реквизит</Вид>
							</Свойство>
						</ТаблицаСвойствОбъекта>
					</ЭлементОтбора>
				</ОтборПоСвойствамОбъекта>
			</Правило>
			<Правило Отключить="false" Валидное="true">
				<Код>000000007</Код>
				<Наименование>Расшифровка источников прихода клиента</Наименование>
				<ОбъектНастройки>СправочникСсылка.РасшифровкаИсточниковПриходаКлиента</ОбъектНастройки>
				<ОбъектМетаданныхИмя>Справочник.РасшифровкаИсточниковПриходаКлиента</ОбъектМетаданныхИмя>
				<ОбъектМетаданныхТип>Справочник</ОбъектМетаданныхТип>
				<РеквизитРежимаВыгрузки>РежимВыгрузкиПриНеобходимости</РеквизитРежимаВыгрузки>
				<ОтборПоСвойствамПланаОбмена/>
				<ОтборПоСвойствамОбъекта/>
			</Правило>
			<Правило Отключить="false" Валидное="true">
				<Код>000000008</Код>
				<Наименование>Уточнение расшифровки источников прихода клиента</Наименование>
				<ОбъектНастройки>СправочникСсылка.УточнениеРасшифровкиИсточниковПриходаКлиента</ОбъектНастройки>
				<ОбъектМетаданныхИмя>Справочник.УточнениеРасшифровкиИсточниковПриходаКлиента</ОбъектМетаданныхИмя>
				<ОбъектМетаданныхТип>Справочник</ОбъектМетаданныхТип>
				<РеквизитРежимаВыгрузки>РежимВыгрузкиПриНеобходимости</РеквизитРежимаВыгрузки>
				<ОтборПоСвойствамПланаОбмена/>
				<ОтборПоСвойствамОбъекта/>
			</Правило>
		</Группа>
		<Группа Отключить="false">
			<Код>000000002</Код>
			<Наименование>Регистры сведений</Наименование>
			<ТипГруппы>РегистрСведений</ТипГруппы>
			<Правило Отключить="false" Валидное="true">
				<Код>000000001</Код>
				<Наименование>Статусы сделки CRM</Наименование>
				<ОбъектНастройки>РегистрСведенийЗапись.СтатусыСделки</ОбъектНастройки>
				<ОбъектМетаданныхИмя>РегистрСведений.СтатусыСделки</ОбъектМетаданныхИмя>
				<ОбъектМетаданныхТип>РегистрСведений</ОбъектМетаданныхТип>
				<ОтборПоСвойствамПланаОбмена/>
				<ОтборПоСвойствамОбъекта/>
				<ПередОбработкой>Отказ = Истина;
Если НЕ Выгрузка 
		И Объект.ЭтотОбъект.Количество() &gt; 0 
		И Объект.ЭтотОбъект[0].Статус = Перечисления.СтатусыСделки.СогласованиеУПН Тогда
	ЗаявкаНаСделкуОбъект = Объект.Отбор.ЗаявкаНаСделку.Значение.ПолучитьОбъект();
	ЗаявкаНаСделкуОбъект.ДополнительныеСвойства.Вставить("РегистрацияВнешняя", Истина);
	ВыполнитьПравилаРегистрацииДляОбъекта(ЗаявкаНаСделкуОбъект, ПРО.ИмяПланаОбмена);
КонецЕсли;</ПередОбработкой>
			</Правило>
		</Группа>
	</ПравилаРегистрацииОбъектов>
</ПравилаРегистрации>